<html>
<head>
  <meta charset="utf-8"/>
  <title>D3.js</title>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.18/p5.min.js">
  </script>

  <style type="text/css">
  body {
    padding:0;
    margin:0;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
  }

  .axis line {
    length: 400px;
  }

  text {
    font-family: sans-serif;
    font-size: 11px;
  }

  .grid {
    stroke-width:1;
    stroke: black;
    shape-rendering: crispEdges;
    opacity: .2;
  }

  </style>
</head>

<body>
  <script type="text/javascript">

    // var Teff = [4.4096, 4.3855, 4.3576, 4.3251, 4.2865, 4.2380, 4.1766, 4.0928, 4.0376, 3.9658, 3.9297, 3.8855, 3.8355, 3.7965, 3.7514, 3.7016];

    // var L = [3.7600, 3.6118, 3.4433, 3.2380, 3.0184, 2.7381, 2.3815, 1.9087, 1.6002, 1.2157, 1.0298, 0.8186, 0.5562, 0.2325, -0.1523, -0.5742];
    
    // var R = [3.8434, 3.6213, 3.3916, 3.1472, 2.8860, 2.6122, 2.2992, 1.9620, 1.7737, 1.5858, 1.5120, 1.4532, 1.3526, 1.1157, 0.8813, 0.6820];

    // var M = [10, 9, 8, 7, 6, 5, 4, 3, 2.5, 2, 1.8, 1.6, 1.4, 1.2, 1, 0.8];

    // var dataset = [];
    
    

    var dataset = d3.csv("data/iso_c020_0300.UBVRIJHKLM.csv", function (d) {
      return {
       +d,; 
      };
    }, function(error, rows) {
      console.log(rows);
    });

    var M = [];
    var L = [];
    var Teff = [];
    var R = [];

    var t = 10; // age, time as log, so 10^t
    

    // push values of dataset to arrays for each property (M, L, Teff)
    for (i = 0; i <= dataset.length; i = i+3) {
      M.push(parseFloat(dataset[i]));
    };

    for (i = 1; i <= dataset.length; i = i+3) {
      L.push(parseFloat(dataset[i]))
    };

    for (i = 2; i <= dataset.length; i = i+3) {
      Teff.push(parseFloat(dataset[i]))
    };

    // get R out of values through formula: R is proportional to M^0.9
    for (i = 0; i <= dataset.length; i = i+3) {
      R.push(parseFloat(Math.pow(dataset[i], 0.9)));
    };


    var datasetTemp = [];

    // push each property back into array in right order
    for (i = 0; i < M.length; i++) {
      var datasetTempArray = [M[i], L[i], Teff[i], R[i]];
      var datasetTempArraySlice = datasetTempArray.slice();
      datasetTemp.push(datasetTempArraySlice);
    };
    dataset = datasetTemp;

    var w = window.innerWidth;
    var h = window.innerHeight;

    var padding = 30;

    //Get max/min values of data
    var max_Teff = d3.max(Teff);
    var min_Teff = d3.min(Teff);
    var max_L = d3.max(L);
    var min_L = d3.min(L);
    var max_R = d3.max(R);
    var min_R = d3.min(R);
    

    //Round min/max values 
    var maxRound_Teff = d3.round(max_Teff);
    var minRound_Teff = d3.round(min_Teff);
    var maxRound_L = d3.round(max_L);
    var minRound_L = d3.round(min_L);

    //Create the SVG Viewport
    var svgContainer = d3.select("body").append("svg")
                                        .attr("width", w)
                                        .attr("height", h);

    //Define the Scale for Teff (x)
    var TeffAxisScale = d3.scale.linear()
                                .domain([maxRound_Teff + 0.5, minRound_Teff -0.5])
                                .range([padding, w-padding]);

    //Define the Scale for L (y)
    var LAxisScale = d3.scale.linear()
                             .domain([maxRound_L + 0.5, minRound_L - 0.5])
                             .range([padding, h-padding]);

    //Define the Scale for R (size circles)
    var RScale = d3.scale.linear()
                         .domain([max_R, min_R])
                         .range([5,1]);

    //Create scattered data in plot
    var circles = svgContainer.selectAll("circle")
                     .data(datasetTemp)
                     .enter()
                     .append("circle")
                     .attr("cx", function(d) {return TeffAxisScale(d[2]); })
                     .attr("cy", function(d) {return LAxisScale(d[1]); })
                     .attr("r",  function(d) {return RScale(d[3])});

    // var text_M = svgContainer.selectAll("text")
    //                          .data(datasetTemp)
    //                          .enter()
    //                          .append("text")
    //                          .text( function(d) {return (d[0]);})
    //                          .attr("x", function(d) {return TeffAxisScale(d[2]) + 10})
    //                          .attr("y", function(d) {return LAxisScale(d[1]) - 10});

    //Create gridlines on axises

    for (i = -5; i <= 5; i++) {
      var lines_y = svgContainer.append("line")
                             .attr("x1", 0 + padding)
                             .attr("y1", LAxisScale(i))
                             .attr("x2", w - padding)
                             .attr("y2", LAxisScale(i))
                             .attr("class", "grid lines-y");
    }

    for (i = -5; i <= 5; i = i +.1) {
      var lines_x = svgContainer.append("line")
                             .attr("x1", TeffAxisScale(i))
                             .attr("y1", 0 + padding)
                             .attr("x2", TeffAxisScale(i))
                             .attr("y2", h - padding)
                             .attr("class", "grid lines-x");
    }

    

    //Create the TeffAxis (x)
    var TeffAxis = d3.svg.axis()
                         .scale(TeffAxisScale)
                         .orient("bottom")
                         .ticks(5);
    
    //Create label on TeffAxis (x)
    var TeffAxisLabel = svgContainer.append("text")
                               .attr("class", "teff-label label")
                               .attr("x", w - (padding + 5))
                               .attr("y", h - (padding + 5))
                               .attr("text-anchor", "end")
                               .text("logTeff");

    //Create the LAxis (y)
    var LAxis = d3.svg.axis()
                      .scale(LAxisScale)
                      .orient("left")
                      .ticks(7);

    //Create label on LAxis (y)
    var LAxisLabel = svgContainer.append("text")
                           .attr("class", "l-label label")
                           .attr("x", padding + 5)
                           .attr("y", padding + 5)
                           .text("logL");
    
    //Create an SVG group Element for the TeffAxis elements and call the TeffAxis function (x)
    var TeffAxisGroup = svgContainer.append("g")
                                    .attr("class", "text teff-axis axis")
                                    .attr("transform", "translate(0," + (h - padding) + ")")
                                    .call(TeffAxis);

    //Create an SVG group Element for the TeffAxis elements and call the TeffAxis function (x)
    var LAxisGroup = svgContainer.append("g")
                                    .attr("class", "text l-axis axis")
                                    .attr("transform", "translate(" + padding + ", 0)")
                                    .call(LAxis);

    //Create age label
    var Timestamp = svgContainer.append("text")
                                .attr("class", "label timestamp")
                                .attr("x", w-padding)
                                .attr("y", padding)
                                .attr("text-anchor", "end")
                                .text("log(age) = " + t);

  </script>
</body>
